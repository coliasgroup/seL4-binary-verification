spec-version: 0.36.0
name: sel4-bv
version: 0.1.0.0
synopsis: TODO
description: TODO
license: BSD-2-Clause
author: Nick Spinale (Colias Group, LLC)
maintainer: Nick Spinale <nick@nickspinale.com>
copyright: Copyright (c) 2025 Colias Group, LLC

language: GHC2021

default-extensions:
  - FunctionalDependencies
  # records
  - OverloadedLabels
  - OverloadedRecordDot
  # GHC2024
  - DerivingStrategies
  - GeneralizedNewtypeDeriving
  - LambdaCase

ghc-options:
  - -Wall
  - -Wno-unused-do-bind

dependencies:
  - base

internal-libraries:

  smtlib2:
    visibility: public
    source-dirs: components/smtlib2
    default-extensions:
      - DuplicateRecordFields
      - NoFieldSelectors
    # exposed-modules: # TODO
    dependencies:
      # external
      - deepseq
      - transformers
      - mtl
      - exceptions
      - text
      - attoparsec
      - megaparsec

  smtlib2-process:
    visibility: public
    source-dirs: components/smtlib2-process
    default-extensions:
      - DuplicateRecordFields
      - NoFieldSelectors
    # exposed-modules: # TODO
    dependencies:
      - sel4-bv:smtlib2
      # external
      - mtl
      - free
      - text
      - exceptions
      - process
      - async
      - stm
      - unliftio-core
      - conduit
      - conduit-extra
  
  core:
    visibility: public
    source-dirs: components/core
    default-extensions:
      - DuplicateRecordFields
      - NoFieldSelectors
    exposed-modules:
      - BV.Core.Types
      - BV.Core.Types.Extras
      - BV.Core.Stages
      - BV.Core.AdornProofScript
      - BV.Core.ExecuteSMTProofChecks
    dependencies:
      - sel4-bv:smtlib2
      # external
      - deepseq
      - containers
      - transformers
      - mtl
      - exceptions
      - optics
      - file-embed
      # TODO for debugging
      - filepath
      - pretty-show
      # - pretty-simple

  concrete-syntax:
    visibility: public
    source-dirs: components/concrete-syntax
    default-extensions:
      - DuplicateRecordFields
      - NoFieldSelectors
    exposed-modules:
      - BV.ConcreteSyntax
    dependencies:
      - sel4-bv:core
      - sel4-bv:smtlib2
      # external
      - containers
      - dlist
      - optics
      - bytestring
      - text
      - megaparsec
      - attoparsec
      - aeson

  target-dir:
    visibility: public
    source-dirs: components/target-dir
    default-extensions:
      - DuplicateRecordFields
      - NoFieldSelectors
    exposed-modules:
      - BV.TargetDir
    dependencies:
      - sel4-bv:core
      - sel4-bv:concrete-syntax
      # external
      - mtl
      - text
      - bytestring
      - aeson
      - filepath

  system:
    visibility: public
    source-dirs: components/system
    default-extensions:
      - DuplicateRecordFields
      - NoFieldSelectors
    # exposed-modules: # TODO
    dependencies:
      - sel4-bv:smtlib2
      - sel4-bv:smtlib2-process
      - sel4-bv:core
      - sel4-bv:concrete-syntax
      - sel4-bv:target-dir
      # external
      - deepseq
      - containers
      - transformers
      - mtl
      - exceptions
      - free
      - optics
      - async
      - stm
      - bytestring
      - text
      - base16-bytestring
      - attoparsec
      - megaparsec
      - cryptohash-sha256
      - process
      - filepath
      - directory
      - monad-logger
      - unliftio-core
      # TODO prune
      - pretty-show
      # - pretty-simple
      # TODO hack
      - tasty
      - tasty-hunit

  test-utils:
    source-dirs: components/tests/test-utils
    default-extensions:
      - DuplicateRecordFields
      - NoFieldSelectors
    dependencies:
      - sel4-bv:core
      - sel4-bv:concrete-syntax
      - sel4-bv:target-dir
      # external
      - filepath
      # TODO prune
      - pretty-show
      # - pretty-simple

executables:

  cli:
    source-dirs: components/cli
    main: Main.hs
    dependencies:
      - sel4-bv:system
    ghc-options:
      # TODO probably unnecessary here
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N

  normalize-smtlib2:
    source-dirs: components/utils/normalize-smtlib2
    main: Main.hs
    dependencies:
      - sel4-bv:smtlib2

  profiling-scratch:
    source-dirs: components/scratch/profiling
    main: Main.hs
    dependencies:
      - sel4-bv:core
      - sel4-bv:concrete-syntax
      - sel4-bv:system
      - sel4-bv:test-utils
      # external
      - text
    ghc-options:
      # TODO probably unnecessary here
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N

  check-scratch:
    source-dirs: components/scratch/check
    main: Main.hs
    default-extensions:
      - DuplicateRecordFields
      - NoFieldSelectors
    dependencies:
      - sel4-bv:smtlib2
      - sel4-bv:core
      - sel4-bv:system
      - sel4-bv:test-utils
      # external
      - containers
      - filepath
      - optics
    ghc-options:
      # TODO probably unnecessary here
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N

tests:

  core-test:
    source-dirs: components/tests/core-test
    main: Main.hs
    dependencies:
      - sel4-bv:core
      - sel4-bv:concrete-syntax
      - sel4-bv:target-dir
      - sel4-bv:system
      - sel4-bv:test-utils
      # external
      - mtl
      - free
      - monad-logger
      - filepath
      - tasty
      - tasty-hunit
    ghc-options:
      # TODO
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N

  smtlib2-test:
    source-dirs: components/tests/smtlib2-test
    main: Main.hs
    dependencies:
      - sel4-bv:smtlib2
      - sel4-bv:smtlib2-process
      - sel4-bv:target-dir
      # external
      - optics
      - mtl
      - text
      - attoparsec
      - megaparsec
      - filepath
      - process
      - Glob
      - tasty
      - tasty-hunit
    ghc-options:
      # TODO
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N

  concrete-syntax-test:
    source-dirs: components/tests/concrete-syntax-test
    main: Main.hs
    dependencies:
      - sel4-bv:core
      - sel4-bv:concrete-syntax
      - sel4-bv:target-dir
      - sel4-bv:test-utils
      # external
      - mtl
      - text
      - attoparsec
      - megaparsec
      - aeson
      - filepath
      - process
      - Glob
      - tasty
      - tasty-hunit
    ghc-options:
      # TODO
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N

  system-test:
    source-dirs: components/tests/system-test
    main: Main.hs
    dependencies:
      - sel4-bv:system
    ghc-options:
      # TODO
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N
